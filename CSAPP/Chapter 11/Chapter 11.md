https://www.youtube.com/watch?v=OynSMXfNtiM&list=PL22J-I2Pi-Gf0s1CGDVtt4vuvlyjLxfem&index=21

A Client-Server Transaction
- Most network applications are based on the client-server model:
	- A server process and one or more client processes
	- Server manages some resource
	- Server provides service by manipulating resource for clients
	- Server activated by request from client (vending machine analogy
	- ![[Pasted image 20251031165649.png]]
- ![[Pasted image 20251031165735.png]]
	- From the hardware perspective, the interface to a between the network and your computer is called NIC, or network interface card
		- ![[Pasted image 20251031170714.png]]
		- Network interface card
		- The interesting thing is that it looks to your computer like an I/O device
		- And unix API dealing with networks, make it looks like a file.
- Computer Networks
	- A network is a hierarchical system of boxes and wires organized by geographical proximity
		- SAN (System Area Network) spans cluster or machine room
			- Switched Ethernet, Quadrics QSW, ...
		- LAN (Local Area Network) spans a building or campus
			- Ethernet is most prominent example
		- WAN (Wide Area Network) spans country or world
			- Typically high-speed point-to-point phone lines
	- An internetwork (internet) is an interconnected set of networks
		- The Global IP Internet (uppercase "I") is the most famous example of an internet (lowercase "i")
- Lowest Level: Ethernet Segment
	- ![[Pasted image 20251031171146.png]]
	- Ethernet segment consists of a collection of hosts connected by wires (twisted pairs) to a hub
		-  Sharing a single communication channel
	- Spans room or floor in a building
	- Operation
		- Each Ethernet adapter has a unique 48-bit address (MAC address)
			- E.g., 00:16:ea:e3:54:e6
		- Hosts send bits to any other host in chunks called frames
		- Hub slavishly copies each bit from each port to every other port
			- Every host sees every bit
		- Note: Hubs are obsolete. Bridges (switches, routers) became cheap enough to replace them
- Next Level: Bridged Ethernet Segment
	- ![[Pasted image 20251031171158.png]]
	- Spans building or campus
	- Bridges cleverly learn which hosts are reachable from which ports and then selectively copy frames from port to port
- Conceptual View of LANs
	- For simplicity, hubs, bridges, and wires are often shown as a collection of hosts attached to a single wire:
	- Bunch of hosts, where they can easily communication on one other
	- ![[Pasted image 20251031171326.png]]
- Next Level: internets
	- Multiple incompatible LANs can be physically connected by specialized computers called routers
	- The connected networks are called an internet (lower case)
	- ![[Pasted image 20251031171416.png]]
	- LAN 1 and LAN 2 might be completely different, totally incompatible (e.g., Ethernet, Fibre Channel, 802.11*, T1-links, DSL, …)
- Logical Structure of an internet
	- Whole bunch of host spread potentially all across the world and then some magical system of routers that will get a message from one place to the other, based on the mode of addressing. And it will hub through multiple routers to get from one place to the other.
	- ![[Pasted image 20251031171722.png]]
	- Ad hoc interconnection of networks
		- No particular topology
		- Vastly different router & link capacities
	- Send packets from source to destination by hopping through networks
		- Router forms bridge from one network to another
		- Different packets may take different routes
- The Notion of an internet Protocol
	- How is it possible to send bits across incompatible LANs and WANs?
	- Solution: protocol software running on each host and router
		- Protocol is a set of rules that governs how hosts and routers should cooperate when they transfer data from network to network.
		- Smooths out the differences between the different networks
- What Does an internet Protocol Do?
	- Provides a naming scheme
		- An internet protocol defines a uniform format for host addresses
		- Each host (and router) is assigned at least one of these internet addresses that uniquely identifies it
	- Provides a delivery mechanism
		- An internet protocol defines a standard transfer unit (packet)
			- packets are around 1000-2000 bytes
		- Packet consists of header and payload
			- Header: contains info such as packet size, source and destination addresses
			- Payload: contains data bits sent from source host
- Transferring internet data via encapsulation
	- we want to send a packet from Host A to Host B
	- ![[Pasted image 20251031173341.png]]
	- Idea of packet communication
		-  Put little headers on that contain the routing information equivalent on the front of an envelope of a letter
	- The LAN1 adapter, the network interface card or adaptor 
		- is responsible for putting that out over this local communication capability
	- LAN2 - puts its own frame header
		- Encapsulation, decapsulation.
- Global IP Internet
	- Based on the TCP/IP protocol family
		- IP (Internet Protocol)
			- Provides basic naming scheme and unreliable delivery capability of packets (datagrams) from host-to-host
		- UDP (Unreliable Datagram Protocol)
			- Uses IP to provide unreliable datagram delivery from process-to-process
		- TCP (Transmission Control Protocol) - 99%
			- Uses IP to provide reliable byte streams from process-to-process over connections
	- Accessed via a mix of Unix file I/O and functions from the sockets interface
- Hardware and Software Organization of a Client-Server Internet Application
	- ![[Pasted image 20251031173824.png]]
- A Programmer’s View of the Internet
	- 1. Hosts are mapped to a set of 32-bit IP addresses
		- 128.2.203.179
		- 127.0.0.1 (always localhost)
		- passed and stored in network byte order which is big endian byte order
	- 2. The set of IP addresses is mapped to a set of identifiers called Internet domain names
		- 128.2.217.3 is mapped to www.cs.cmu.edu
			- 128.2... == cmu
	- 3. A process on one Internet host can communicate with a process on another Internet host over a connection
- Aside: IPv4 and IPv6
	- The original Internet Protocol, with its 32-bit addresses, is known as Internet Protocol Version 4 (IPv4)
	- 1996: Internet Engineering Task Force (IETF) introduced Internet Protocol Version 6 (IPv6) with 128-bit addresses
		- Intended as the successor to IPv4
- (1) IP Addresses
	- 32-bit IP addresses are stored in an IP address struct
		- IP addresses are always stored in memory in network byte order (big-endian byte order)
		- True in general for any integer transferred in a packet header from one machine to another.
			- E.g., the port number used to identify an Internet connection.
			- ![[Pasted image 20251031174449.png]]
		- Useful network byte-order conversion functions ("I" = 32 bits, "s" = 16 bits)
			- htonl : convert uint32_t from host to network byte order
			- htons : convert uint16_t from host to network byte order
			- ntohl : convert uint32_t from network to host byte order
			- ntohs : convert uint16_t from network to host byte order
- Dotted Decimal Notation
	- By convention, each byte in a 32-bit IP address is represented by its decimal value and separated by a period
		- IP address: 0x8002C2F2 = 128.2.194.242 (Big Endian)
	- Functions for converting between binary IP addresses and dotted decimal strings:
		- inet pton: dotted decimal string > IP address in network byte order
		- inet_ntop: IP address in network byte order > dotted decimal string
		- "n" denotes network
		- "p" denotes presentation
- Domain Naming System (DNS)
	- The Internet maintains a mapping between IP addresses and domain names in a huge worldwide distributed database called DNS
	- Conceptually, programmers can view the DNS database as a collection of millions of host entries.
		- Each host entry defines the mapping between a set of domain names and IP addresses.
		- In a mathematical sense, a host entry is an equivalence class of domain names and IP addresses.
	- We can think of a big database that gives me a mapping where I can give a domain name and it will get back to me a one or more IP addresses. Or the other way, I can give an IP address and it will come back with one or more domain names.
- Properties of DNS Mappings
	- Can explore properties of DNS mappings using nslookup
	- Each host has a locally defined domain name localhost which always maps to the loopback address 127.0.0.1
	- ![[Pasted image 20251031180146.png]]
	- Use hostname to determine real domain name of local host:
	- ![[Pasted image 20251031180158.png]]
	- Simple case: one-to-one mapping between domain name and IP address:
	- ![[Pasted image 20251031180355.png]]
	- Multiple domain names mapped to the same IP address:
	- ![[Pasted image 20251031180411.png]]
	- Multiple domain names mapped to multiple IP addresses:
	- ![[Pasted image 20251031180443.png]]
	- Some valid domain names don’t map to any IP address:
	- ![[Pasted image 20251031180459.png]]
- (3) Internet Connections
	- Clients and servers communicate by sending streams of bytes over connections. Each connection is:
		- Point-to-point: connects a pair of processes.
		- Full-duplex: data can flow in both directions at the same time,
		- Reliable: stream of bytes sent by the source is eventually received by the destination in the same order it was sent.
	- A socket is an endpoint of a connection
		- Socket address is an IPaddress:port pair
	- A port is a 16-bit integer that identifies a process
		- Ephemeral port: Assigned automatically by client kernel when client makes a connection request.
			- Usually connected with the limited amount of time
		- Well-known port: Associated with some service provided by a server (e.g., port 80 is associated with Web servers)
- Well-known Service Names and Ports
	- Popular services have permanently assigned well-known ports and corresponding well-known service names:
		- echo servers: echo 7
		- ftp servers: ftp 21
		- ssh servers: ssh 22
		- email servers: smtp 25
		- Web servers: http 80
	- Mappings between well-known ports and service names is contained in the file /etc/services on each Linux machine.
- Anatomy of a Connection
	- A connection is uniquely identified by the socket addresses of its endpoints (socket pair)
		- (cliaddr:cliport, servaddr:servport)
	- ![[Pasted image 20251031180940.png]]
	- ![[Pasted image 20251031181021.png]]
- Sockets Interface
	- Set of system-level functions used in conjunction with Unix I/O to build network applications
	- Created in the early 80’s as part of the original Berkeley distribution of Unix that contained an early version of the Internet protocols.
	- Available on all modern systems
		- Unix variants, Windows, OS X, IOS, Android, ARM
- Sockets
	- What is a socket?
		- To the kernel, a socket is an endpoint of communication
		- To an application, a socket is a file descriptor that lets the application read/write from/to the network
			- Remember: All Unix I/O devices, including networks, are modeled as files
	- Clients and servers communicate with each other by reading from and writing to socket descriptors
	- ![[Pasted image 20251031181254.png]]
	- The main distinction between regular file I/O and socket I/O is how the application “opens” the socket descriptors
-  Socket Address Structures
	- Generic socket address:
		- For address arguments to connect, bind, and accept (next lecture)
		- Necessary only because C did not have generic (void *) pointers when the sockets interface was designed
		- For casting convenience, we adopt the Stevens convention:
			- typedef struct sockaddr SA;
		- sa_family - designated what type of socket this is - TPC socket, IPv6 socket, UDP socket 
		- ![[Pasted image 20251031185314.png]]
	- Internet (IPv4) specific socket address:
		- Must cast (struct sockaddr_in *) to (struct sockaddr *) for functions that take socket address arguments.
		- ![[Pasted image 20251031185352.png]]
		- Still in big endian
		- it's like a subclass of sockaddr
- Echo server and client structure
	- ![[Pasted image 20251031185746.png]]
- 